{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"EditMap\", {\n    enumerable: true,\n    get: function () {\n      return EditMap;\n    }\n  });\n  /**\n   * @import {Event} from 'micromark-util-types'\n   */\n\n  // Port of `edit_map.rs` from `markdown-rs`.\n  // This should move to `markdown-js` later.\n\n  // Deal with several changes in events, batching them together.\n  //\n  // Preferably, changes should be kept to a minimum.\n  // Sometimes, it’s needed to change the list of events, because parsing can be\n  // messy, and it helps to expose a cleaner interface of events to the compiler\n  // and other users.\n  // It can also help to merge many adjacent similar events.\n  // And, in other cases, it’s needed to parse subcontent: pass some events\n  // through another tokenizer and inject the result.\n\n  /**\n   * @typedef {[number, number, Array<Event>]} Change\n   * @typedef {[number, number, number]} Jump\n   */\n\n  /**\n   * Tracks a bunch of edits.\n   */\n  class EditMap {\n    /**\n     * Create a new edit map.\n     */\n    constructor() {\n      /**\n       * Record of changes.\n       *\n       * @type {Array<Change>}\n       */\n      this.map = [];\n    }\n\n    /**\n     * Create an edit: a remove and/or add at a certain place.\n     *\n     * @param {number} index\n     * @param {number} remove\n     * @param {Array<Event>} add\n     * @returns {undefined}\n     */\n    add(index, remove, add) {\n      addImplementation(this, index, remove, add);\n    }\n\n    // To do: add this when moving to `micromark`.\n    // /**\n    //  * Create an edit: but insert `add` before existing additions.\n    //  *\n    //  * @param {number} index\n    //  * @param {number} remove\n    //  * @param {Array<Event>} add\n    //  * @returns {undefined}\n    //  */\n    // addBefore(index, remove, add) {\n    //   addImplementation(this, index, remove, add, true)\n    // }\n\n    /**\n     * Done, change the events.\n     *\n     * @param {Array<Event>} events\n     * @returns {undefined}\n     */\n    consume(events) {\n      this.map.sort(function (a, b) {\n        return a[0] - b[0];\n      });\n\n      /* c8 ignore next 3 -- `resolve` is never called without tables, so without edits. */\n      if (this.map.length === 0) {\n        return;\n      }\n\n      // To do: if links are added in events, like they are in `markdown-rs`,\n      // this is needed.\n      // // Calculate jumps: where items in the current list move to.\n      // /** @type {Array<Jump>} */\n      // const jumps = []\n      // let index = 0\n      // let addAcc = 0\n      // let removeAcc = 0\n      // while (index < this.map.length) {\n      //   const [at, remove, add] = this.map[index]\n      //   removeAcc += remove\n      //   addAcc += add.length\n      //   jumps.push([at, removeAcc, addAcc])\n      //   index += 1\n      // }\n      //\n      // . shiftLinks(events, jumps)\n\n      let index = this.map.length;\n      /** @type {Array<Array<Event>>} */\n      const vecs = [];\n      while (index > 0) {\n        index -= 1;\n        vecs.push(events.slice(this.map[index][0] + this.map[index][1]), this.map[index][2]);\n\n        // Truncate rest.\n        events.length = this.map[index][0];\n      }\n      vecs.push(events.slice());\n      events.length = 0;\n      let slice = vecs.pop();\n      while (slice) {\n        for (const element of slice) {\n          events.push(element);\n        }\n        slice = vecs.pop();\n      }\n\n      // Truncate everything.\n      this.map.length = 0;\n    }\n  }\n\n  /**\n   * Create an edit.\n   *\n   * @param {EditMap} editMap\n   * @param {number} at\n   * @param {number} remove\n   * @param {Array<Event>} add\n   * @returns {undefined}\n   */\n  function addImplementation(editMap, at, remove, add) {\n    let index = 0;\n\n    /* c8 ignore next 3 -- `resolve` is never called without tables, so without edits. */\n    if (remove === 0 && add.length === 0) {\n      return;\n    }\n    while (index < editMap.map.length) {\n      if (editMap.map[index][0] === at) {\n        editMap.map[index][1] += remove;\n\n        // To do: before not used by tables, use when moving to micromark.\n        // if (before) {\n        //   add.push(...editMap.map[index][2])\n        //   editMap.map[index][2] = add\n        // } else {\n        editMap.map[index][2].push(...add);\n        // }\n\n        return;\n      }\n      index += 1;\n    }\n    editMap.map.push([at, remove, add]);\n  }\n\n  // /**\n  //  * Shift `previous` and `next` links according to `jumps`.\n  //  *\n  //  * This fixes links in case there are events removed or added between them.\n  //  *\n  //  * @param {Array<Event>} events\n  //  * @param {Array<Jump>} jumps\n  //  */\n  // function shiftLinks(events, jumps) {\n  //   let jumpIndex = 0\n  //   let index = 0\n  //   let add = 0\n  //   let rm = 0\n\n  //   while (index < events.length) {\n  //     const rmCurr = rm\n\n  //     while (jumpIndex < jumps.length && jumps[jumpIndex][0] <= index) {\n  //       add = jumps[jumpIndex][2]\n  //       rm = jumps[jumpIndex][1]\n  //       jumpIndex += 1\n  //     }\n\n  //     // Ignore items that will be removed.\n  //     if (rm > rmCurr) {\n  //       index += rm - rmCurr\n  //     } else {\n  //       // ?\n  //       // if let Some(link) = &events[index].link {\n  //       //     if let Some(next) = link.next {\n  //       //         events[next].link.as_mut().unwrap().previous = Some(index + add - rm);\n  //       //         while jumpIndex < jumps.len() && jumps[jumpIndex].0 <= next {\n  //       //             add = jumps[jumpIndex].2;\n  //       //             rm = jumps[jumpIndex].1;\n  //       //             jumpIndex += 1;\n  //       //         }\n  //       //         events[index].link.as_mut().unwrap().next = Some(next + add - rm);\n  //       //         index = next;\n  //       //         continue;\n  //       //     }\n  //       // }\n  //       index += 1\n  //     }\n  //   }\n  // }\n});","lineCount":215,"map":[[7,2,26,0,"Object"],[7,8,26,0],[7,9,26,0,"defineProperty"],[7,23,26,0],[7,24,26,0,"exports"],[7,31,26,0],[8,4,26,0,"enumerable"],[8,14,26,0],[9,4,26,0,"get"],[9,7,26,0],[9,18,26,0,"get"],[9,19,26,0],[10,6,26,0],[10,13,26,0,"EditMap"],[10,20,26,0],[11,4,26,0],[12,2,26,0],[13,2,1,0],[14,0,2,0],[15,0,3,0],[17,2,5,0],[18,2,6,0],[20,2,8,0],[21,2,9,0],[22,2,10,0],[23,2,11,0],[24,2,12,0],[25,2,13,0],[26,2,14,0],[27,2,15,0],[28,2,16,0],[30,2,18,0],[31,0,19,0],[32,0,20,0],[33,0,21,0],[35,2,23,0],[36,0,24,0],[37,0,25,0],[38,2,26,7],[38,8,26,13,"EditMap"],[38,15,26,20],[38,16,26,21],[39,4,27,2],[40,0,28,0],[41,0,29,0],[42,4,30,2,"constructor"],[42,15,30,13,"constructor"],[42,16,30,13],[42,18,30,16],[43,6,31,4],[44,0,32,0],[45,0,33,0],[46,0,34,0],[47,0,35,0],[48,6,36,4],[48,10,36,8],[48,11,36,9,"map"],[48,14,36,12],[48,17,36,15],[48,19,36,17],[49,4,37,2],[51,4,39,2],[52,0,40,0],[53,0,41,0],[54,0,42,0],[55,0,43,0],[56,0,44,0],[57,0,45,0],[58,0,46,0],[59,4,47,2,"add"],[59,7,47,5,"add"],[59,8,47,6,"index"],[59,13,47,11],[59,15,47,13,"remove"],[59,21,47,19],[59,23,47,21,"add"],[59,26,47,24],[59,28,47,26],[60,6,48,4,"addImplementation"],[60,23,48,21],[60,24,48,22],[60,28,48,26],[60,30,48,28,"index"],[60,35,48,33],[60,37,48,35,"remove"],[60,43,48,41],[60,45,48,43,"add"],[60,48,48,46],[60,49,48,47],[61,4,49,2],[63,4,51,2],[64,4,52,2],[65,4,53,2],[66,4,54,2],[67,4,55,2],[68,4,56,2],[69,4,57,2],[70,4,58,2],[71,4,59,2],[72,4,60,2],[73,4,61,2],[74,4,62,2],[76,4,64,2],[77,0,65,0],[78,0,66,0],[79,0,67,0],[80,0,68,0],[81,0,69,0],[82,4,70,2,"consume"],[82,11,70,9,"consume"],[82,12,70,10,"events"],[82,18,70,16],[82,20,70,18],[83,6,71,4],[83,10,71,8],[83,11,71,9,"map"],[83,14,71,12],[83,15,71,13,"sort"],[83,19,71,17],[83,20,71,18],[83,30,71,28,"a"],[83,31,71,29],[83,33,71,31,"b"],[83,34,71,32],[83,36,71,34],[84,8,72,6],[84,15,72,13,"a"],[84,16,72,14],[84,17,72,15],[84,18,72,16],[84,19,72,17],[84,22,72,20,"b"],[84,23,72,21],[84,24,72,22],[84,25,72,23],[84,26,72,24],[85,6,73,4],[85,7,73,5],[85,8,73,6],[87,6,75,4],[88,6,76,4],[88,10,76,8],[88,14,76,12],[88,15,76,13,"map"],[88,18,76,16],[88,19,76,17,"length"],[88,25,76,23],[88,30,76,28],[88,31,76,29],[88,33,76,31],[89,8,77,6],[90,6,78,4],[92,6,80,4],[93,6,81,4],[94,6,82,4],[95,6,83,4],[96,6,84,4],[97,6,85,4],[98,6,86,4],[99,6,87,4],[100,6,88,4],[101,6,89,4],[102,6,90,4],[103,6,91,4],[104,6,92,4],[105,6,93,4],[106,6,94,4],[107,6,95,4],[108,6,96,4],[110,6,98,4],[110,10,98,8,"index"],[110,15,98,13],[110,18,98,16],[110,22,98,20],[110,23,98,21,"map"],[110,26,98,24],[110,27,98,25,"length"],[110,33,98,31],[111,6,99,4],[112,6,100,4],[112,12,100,10,"vecs"],[112,16,100,14],[112,19,100,17],[112,21,100,19],[113,6,101,4],[113,13,101,11,"index"],[113,18,101,16],[113,21,101,19],[113,22,101,20],[113,24,101,22],[114,8,102,6,"index"],[114,13,102,11],[114,17,102,15],[114,18,102,16],[115,8,103,6,"vecs"],[115,12,103,10],[115,13,103,11,"push"],[115,17,103,15],[115,18,103,16,"events"],[115,24,103,22],[115,25,103,23,"slice"],[115,30,103,28],[115,31,103,29],[115,35,103,33],[115,36,103,34,"map"],[115,39,103,37],[115,40,103,38,"index"],[115,45,103,43],[115,46,103,44],[115,47,103,45],[115,48,103,46],[115,49,103,47],[115,52,103,50],[115,56,103,54],[115,57,103,55,"map"],[115,60,103,58],[115,61,103,59,"index"],[115,66,103,64],[115,67,103,65],[115,68,103,66],[115,69,103,67],[115,70,103,68],[115,71,103,69],[115,73,103,71],[115,77,103,75],[115,78,103,76,"map"],[115,81,103,79],[115,82,103,80,"index"],[115,87,103,85],[115,88,103,86],[115,89,103,87],[115,90,103,88],[115,91,103,89],[115,92,103,90],[117,8,105,6],[118,8,106,6,"events"],[118,14,106,12],[118,15,106,13,"length"],[118,21,106,19],[118,24,106,22],[118,28,106,26],[118,29,106,27,"map"],[118,32,106,30],[118,33,106,31,"index"],[118,38,106,36],[118,39,106,37],[118,40,106,38],[118,41,106,39],[118,42,106,40],[119,6,107,4],[120,6,108,4,"vecs"],[120,10,108,8],[120,11,108,9,"push"],[120,15,108,13],[120,16,108,14,"events"],[120,22,108,20],[120,23,108,21,"slice"],[120,28,108,26],[120,29,108,27],[120,30,108,28],[120,31,108,29],[121,6,109,4,"events"],[121,12,109,10],[121,13,109,11,"length"],[121,19,109,17],[121,22,109,20],[121,23,109,21],[122,6,110,4],[122,10,110,8,"slice"],[122,15,110,13],[122,18,110,16,"vecs"],[122,22,110,20],[122,23,110,21,"pop"],[122,26,110,24],[122,27,110,25],[122,28,110,26],[123,6,111,4],[123,13,111,11,"slice"],[123,18,111,16],[123,20,111,18],[124,8,112,6],[124,13,112,11],[124,19,112,17,"element"],[124,26,112,24],[124,30,112,28,"slice"],[124,35,112,33],[124,37,112,35],[125,10,113,8,"events"],[125,16,113,14],[125,17,113,15,"push"],[125,21,113,19],[125,22,113,20,"element"],[125,29,113,27],[125,30,113,28],[126,8,114,6],[127,8,115,6,"slice"],[127,13,115,11],[127,16,115,14,"vecs"],[127,20,115,18],[127,21,115,19,"pop"],[127,24,115,22],[127,25,115,23],[127,26,115,24],[128,6,116,4],[130,6,118,4],[131,6,119,4],[131,10,119,8],[131,11,119,9,"map"],[131,14,119,12],[131,15,119,13,"length"],[131,21,119,19],[131,24,119,22],[131,25,119,23],[132,4,120,2],[133,2,121,0],[135,2,123,0],[136,0,124,0],[137,0,125,0],[138,0,126,0],[139,0,127,0],[140,0,128,0],[141,0,129,0],[142,0,130,0],[143,0,131,0],[144,2,132,0],[144,11,132,9,"addImplementation"],[144,28,132,26,"addImplementation"],[144,29,132,27,"editMap"],[144,36,132,34],[144,38,132,36,"at"],[144,40,132,38],[144,42,132,40,"remove"],[144,48,132,46],[144,50,132,48,"add"],[144,53,132,51],[144,55,132,53],[145,4,133,2],[145,8,133,6,"index"],[145,13,133,11],[145,16,133,14],[145,17,133,15],[147,4,135,2],[148,4,136,2],[148,8,136,6,"remove"],[148,14,136,12],[148,19,136,17],[148,20,136,18],[148,24,136,22,"add"],[148,27,136,25],[148,28,136,26,"length"],[148,34,136,32],[148,39,136,37],[148,40,136,38],[148,42,136,40],[149,6,137,4],[150,4,138,2],[151,4,139,2],[151,11,139,9,"index"],[151,16,139,14],[151,19,139,17,"editMap"],[151,26,139,24],[151,27,139,25,"map"],[151,30,139,28],[151,31,139,29,"length"],[151,37,139,35],[151,39,139,37],[152,6,140,4],[152,10,140,8,"editMap"],[152,17,140,15],[152,18,140,16,"map"],[152,21,140,19],[152,22,140,20,"index"],[152,27,140,25],[152,28,140,26],[152,29,140,27],[152,30,140,28],[152,31,140,29],[152,36,140,34,"at"],[152,38,140,36],[152,40,140,38],[153,8,141,6,"editMap"],[153,15,141,13],[153,16,141,14,"map"],[153,19,141,17],[153,20,141,18,"index"],[153,25,141,23],[153,26,141,24],[153,27,141,25],[153,28,141,26],[153,29,141,27],[153,33,141,31,"remove"],[153,39,141,37],[155,8,143,6],[156,8,144,6],[157,8,145,6],[158,8,146,6],[159,8,147,6],[160,8,148,6,"editMap"],[160,15,148,13],[160,16,148,14,"map"],[160,19,148,17],[160,20,148,18,"index"],[160,25,148,23],[160,26,148,24],[160,27,148,25],[160,28,148,26],[160,29,148,27],[160,30,148,28,"push"],[160,34,148,32],[160,35,148,33],[160,38,148,36,"add"],[160,41,148,39],[160,42,148,40],[161,8,149,6],[163,8,151,6],[164,6,152,4],[165,6,153,4,"index"],[165,11,153,9],[165,15,153,13],[165,16,153,14],[166,4,154,2],[167,4,155,2,"editMap"],[167,11,155,9],[167,12,155,10,"map"],[167,15,155,13],[167,16,155,14,"push"],[167,20,155,18],[167,21,155,19],[167,22,155,20,"at"],[167,24,155,22],[167,26,155,24,"remove"],[167,32,155,30],[167,34,155,32,"add"],[167,37,155,35],[167,38,155,36],[167,39,155,37],[168,2,156,0],[170,2,158,0],[171,2,159,0],[172,2,160,0],[173,2,161,0],[174,2,162,0],[175,2,163,0],[176,2,164,0],[177,2,165,0],[178,2,166,0],[179,2,167,0],[180,2,168,0],[181,2,169,0],[182,2,170,0],[184,2,172,0],[185,2,173,0],[187,2,175,0],[188,2,176,0],[189,2,177,0],[190,2,178,0],[191,2,179,0],[193,2,181,0],[194,2,182,0],[195,2,183,0],[196,2,184,0],[197,2,185,0],[198,2,186,0],[199,2,187,0],[200,2,188,0],[201,2,189,0],[202,2,190,0],[203,2,191,0],[204,2,192,0],[205,2,193,0],[206,2,194,0],[207,2,195,0],[208,2,196,0],[209,2,197,0],[210,2,198,0],[211,2,199,0],[212,2,200,0],[213,2,201,0],[214,2,202,0],[215,0,202,0],[215,3]],"functionMap":{"names":["<global>","EditMap","EditMap#constructor","EditMap#add","EditMap#consume","map.sort$argument_0","addImplementation"],"mappings":"AAA;OCyB;ECI;GDO;EEU;GFE;EGqB;kBCC;KDE;GH+C;CDC;AMW;CNwB"},"hasCjsExports":false},"type":"js/module"}]}
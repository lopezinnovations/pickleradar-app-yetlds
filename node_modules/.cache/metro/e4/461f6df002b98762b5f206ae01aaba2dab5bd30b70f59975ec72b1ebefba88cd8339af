{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.trough = trough;\n  exports.wrap = wrap;\n  // To do: remove `void`s\n  // To do: remove `null` from output of our APIs, allow it as user APIs.\n\n  /**\n   * @typedef {(error?: Error | null | undefined, ...output: Array<any>) => void} Callback\n   *   Callback.\n   *\n   * @typedef {(...input: Array<any>) => any} Middleware\n   *   Ware.\n   *\n   * @typedef Pipeline\n   *   Pipeline.\n   * @property {Run} run\n   *   Run the pipeline.\n   * @property {Use} use\n   *   Add middleware.\n   *\n   * @typedef {(...input: Array<any>) => void} Run\n   *   Call all middleware.\n   *\n   *   Calls `done` on completion with either an error or the output of the\n   *   last middleware.\n   *\n   *   > ðŸ‘‰ **Note**: as the length of input defines whether async functions get a\n   *   > `next` function,\n   *   > itâ€™s recommended to keep `input` at one value normally.\n  \n   *\n   * @typedef {(fn: Middleware) => Pipeline} Use\n   *   Add middleware.\n   */\n\n  /**\n   * Create new middleware.\n   *\n   * @returns {Pipeline}\n   *   Pipeline.\n   */\n  function trough() {\n    /** @type {Array<Middleware>} */\n    const fns = [];\n    /** @type {Pipeline} */\n    const pipeline = {\n      run,\n      use\n    };\n    return pipeline;\n\n    /** @type {Run} */\n    function run(...values) {\n      let middlewareIndex = -1;\n      /** @type {Callback} */\n      const callback = values.pop();\n      if (typeof callback !== 'function') {\n        throw new TypeError('Expected function as last argument, not ' + callback);\n      }\n      next(null, ...values);\n\n      /**\n       * Run the next `fn`, or weâ€™re done.\n       *\n       * @param {Error | null | undefined} error\n       * @param {Array<any>} output\n       */\n      function next(error, ...output) {\n        const fn = fns[++middlewareIndex];\n        let index = -1;\n        if (error) {\n          callback(error);\n          return;\n        }\n\n        // Copy non-nullish input into values.\n        while (++index < values.length) {\n          if (output[index] === null || output[index] === undefined) {\n            output[index] = values[index];\n          }\n        }\n\n        // Save the newly created `output` for the next call.\n        values = output;\n\n        // Next or done.\n        if (fn) {\n          wrap(fn, next)(...output);\n        } else {\n          callback(null, ...output);\n        }\n      }\n    }\n\n    /** @type {Use} */\n    function use(middelware) {\n      if (typeof middelware !== 'function') {\n        throw new TypeError('Expected `middelware` to be a function, not ' + middelware);\n      }\n      fns.push(middelware);\n      return pipeline;\n    }\n  }\n\n  /**\n   * Wrap `middleware` into a uniform interface.\n   *\n   * You can pass all input to the resulting function.\n   * `callback` is then called with the output of `middleware`.\n   *\n   * If `middleware` accepts more arguments than the later given in input,\n   * an extra `done` function is passed to it after that input,\n   * which must be called by `middleware`.\n   *\n   * The first value in `input` is the main input value.\n   * All other input values are the rest input values.\n   * The values given to `callback` are the input values,\n   * merged with every non-nullish output value.\n   *\n   * * if `middleware` throws an error,\n   *   returns a promise that is rejected,\n   *   or calls the given `done` function with an error,\n   *   `callback` is called with that error\n   * * if `middleware` returns a value or returns a promise that is resolved,\n   *   that value is the main output value\n   * * if `middleware` calls `done`,\n   *   all non-nullish values except for the first one (the error) overwrite the\n   *   output values\n   *\n   * @param {Middleware} middleware\n   *   Function to wrap.\n   * @param {Callback} callback\n   *   Callback called with the output of `middleware`.\n   * @returns {Run}\n   *   Wrapped middleware.\n   */\n  function wrap(middleware, callback) {\n    /** @type {boolean} */\n    let called;\n    return wrapped;\n\n    /**\n     * Call `middleware`.\n     * @this {any}\n     * @param {Array<any>} parameters\n     * @returns {void}\n     */\n    function wrapped(...parameters) {\n      const fnExpectsCallback = middleware.length > parameters.length;\n      /** @type {any} */\n      let result;\n      if (fnExpectsCallback) {\n        parameters.push(done);\n      }\n      try {\n        result = middleware.apply(this, parameters);\n      } catch (error) {\n        const exception = /** @type {Error} */error;\n\n        // Well, this is quite the pickle.\n        // `middleware` received a callback and called it synchronously, but that\n        // threw an error.\n        // The only thing left to do is to throw the thing instead.\n        if (fnExpectsCallback && called) {\n          throw exception;\n        }\n        return done(exception);\n      }\n      if (!fnExpectsCallback) {\n        if (result && result.then && typeof result.then === 'function') {\n          result.then(then, done);\n        } else if (result instanceof Error) {\n          done(result);\n        } else {\n          then(result);\n        }\n      }\n    }\n\n    /**\n     * Call `callback`, only once.\n     *\n     * @type {Callback}\n     */\n    function done(error, ...output) {\n      if (!called) {\n        called = true;\n        callback(error, ...output);\n      }\n    }\n\n    /**\n     * Call `done` with one value.\n     *\n     * @param {any} [value]\n     */\n    function then(value) {\n      done(null, value);\n    }\n  }\n});","lineCount":206,"map":[[7,2,39,0,"exports"],[7,9,39,0],[7,10,39,0,"trough"],[7,16,39,0],[7,19,39,0,"trough"],[7,25,39,0],[8,2,138,0,"exports"],[8,9,138,0],[8,10,138,0,"wrap"],[8,14,138,0],[8,17,138,0,"wrap"],[8,21,138,0],[9,2,1,0],[10,2,2,0],[12,2,4,0],[13,0,5,0],[14,0,6,0],[15,0,7,0],[16,0,8,0],[17,0,9,0],[18,0,10,0],[19,0,11,0],[20,0,12,0],[21,0,13,0],[22,0,14,0],[23,0,15,0],[24,0,16,0],[25,0,17,0],[26,0,18,0],[27,0,19,0],[28,0,20,0],[29,0,21,0],[30,0,22,0],[31,0,23,0],[32,0,24,0],[33,0,25,0],[34,0,26,0],[35,0,27,0],[36,0,28,0],[37,0,29,0],[38,0,30,0],[39,0,31,0],[41,2,33,0],[42,0,34,0],[43,0,35,0],[44,0,36,0],[45,0,37,0],[46,0,38,0],[47,2,39,7],[47,11,39,16,"trough"],[47,17,39,22,"trough"],[47,18,39,22],[47,20,39,25],[48,4,40,2],[49,4,41,2],[49,10,41,8,"fns"],[49,13,41,11],[49,16,41,14],[49,18,41,16],[50,4,42,2],[51,4,43,2],[51,10,43,8,"pipeline"],[51,18,43,16],[51,21,43,19],[52,6,43,20,"run"],[52,9,43,23],[53,6,43,25,"use"],[54,4,43,28],[54,5,43,29],[55,4,45,2],[55,11,45,9,"pipeline"],[55,19,45,17],[57,4,47,2],[58,4,48,2],[58,13,48,11,"run"],[58,16,48,14,"run"],[58,17,48,15],[58,20,48,18,"values"],[58,26,48,24],[58,28,48,26],[59,6,49,4],[59,10,49,8,"middlewareIndex"],[59,25,49,23],[59,28,49,26],[59,29,49,27],[59,30,49,28],[60,6,50,4],[61,6,51,4],[61,12,51,10,"callback"],[61,20,51,18],[61,23,51,21,"values"],[61,29,51,27],[61,30,51,28,"pop"],[61,33,51,31],[61,34,51,32],[61,35,51,33],[62,6,53,4],[62,10,53,8],[62,17,53,15,"callback"],[62,25,53,23],[62,30,53,28],[62,40,53,38],[62,42,53,40],[63,8,54,6],[63,14,54,12],[63,18,54,16,"TypeError"],[63,27,54,25],[63,28,54,26],[63,70,54,68],[63,73,54,71,"callback"],[63,81,54,79],[63,82,54,80],[64,6,55,4],[65,6,57,4,"next"],[65,10,57,8],[65,11,57,9],[65,15,57,13],[65,17,57,15],[65,20,57,18,"values"],[65,26,57,24],[65,27,57,25],[67,6,59,4],[68,0,60,0],[69,0,61,0],[70,0,62,0],[71,0,63,0],[72,0,64,0],[73,6,65,4],[73,15,65,13,"next"],[73,19,65,17,"next"],[73,20,65,18,"error"],[73,25,65,23],[73,27,65,25],[73,30,65,28,"output"],[73,36,65,34],[73,38,65,36],[74,8,66,6],[74,14,66,12,"fn"],[74,16,66,14],[74,19,66,17,"fns"],[74,22,66,20],[74,23,66,21],[74,25,66,23,"middlewareIndex"],[74,40,66,38],[74,41,66,39],[75,8,67,6],[75,12,67,10,"index"],[75,17,67,15],[75,20,67,18],[75,21,67,19],[75,22,67,20],[76,8,69,6],[76,12,69,10,"error"],[76,17,69,15],[76,19,69,17],[77,10,70,8,"callback"],[77,18,70,16],[77,19,70,17,"error"],[77,24,70,22],[77,25,70,23],[78,10,71,8],[79,8,72,6],[81,8,74,6],[82,8,75,6],[82,15,75,13],[82,17,75,15,"index"],[82,22,75,20],[82,25,75,23,"values"],[82,31,75,29],[82,32,75,30,"length"],[82,38,75,36],[82,40,75,38],[83,10,76,8],[83,14,76,12,"output"],[83,20,76,18],[83,21,76,19,"index"],[83,26,76,24],[83,27,76,25],[83,32,76,30],[83,36,76,34],[83,40,76,38,"output"],[83,46,76,44],[83,47,76,45,"index"],[83,52,76,50],[83,53,76,51],[83,58,76,56,"undefined"],[83,67,76,65],[83,69,76,67],[84,12,77,10,"output"],[84,18,77,16],[84,19,77,17,"index"],[84,24,77,22],[84,25,77,23],[84,28,77,26,"values"],[84,34,77,32],[84,35,77,33,"index"],[84,40,77,38],[84,41,77,39],[85,10,78,8],[86,8,79,6],[88,8,81,6],[89,8,82,6,"values"],[89,14,82,12],[89,17,82,15,"output"],[89,23,82,21],[91,8,84,6],[92,8,85,6],[92,12,85,10,"fn"],[92,14,85,12],[92,16,85,14],[93,10,86,8,"wrap"],[93,14,86,12],[93,15,86,13,"fn"],[93,17,86,15],[93,19,86,17,"next"],[93,23,86,21],[93,24,86,22],[93,25,86,23],[93,28,86,26,"output"],[93,34,86,32],[93,35,86,33],[94,8,87,6],[94,9,87,7],[94,15,87,13],[95,10,88,8,"callback"],[95,18,88,16],[95,19,88,17],[95,23,88,21],[95,25,88,23],[95,28,88,26,"output"],[95,34,88,32],[95,35,88,33],[96,8,89,6],[97,6,90,4],[98,4,91,2],[100,4,93,2],[101,4,94,2],[101,13,94,11,"use"],[101,16,94,14,"use"],[101,17,94,15,"middelware"],[101,27,94,25],[101,29,94,27],[102,6,95,4],[102,10,95,8],[102,17,95,15,"middelware"],[102,27,95,25],[102,32,95,30],[102,42,95,40],[102,44,95,42],[103,8,96,6],[103,14,96,12],[103,18,96,16,"TypeError"],[103,27,96,25],[103,28,97,8],[103,74,97,54],[103,77,97,57,"middelware"],[103,87,98,6],[103,88,98,7],[104,6,99,4],[105,6,101,4,"fns"],[105,9,101,7],[105,10,101,8,"push"],[105,14,101,12],[105,15,101,13,"middelware"],[105,25,101,23],[105,26,101,24],[106,6,102,4],[106,13,102,11,"pipeline"],[106,21,102,19],[107,4,103,2],[108,2,104,0],[110,2,106,0],[111,0,107,0],[112,0,108,0],[113,0,109,0],[114,0,110,0],[115,0,111,0],[116,0,112,0],[117,0,113,0],[118,0,114,0],[119,0,115,0],[120,0,116,0],[121,0,117,0],[122,0,118,0],[123,0,119,0],[124,0,120,0],[125,0,121,0],[126,0,122,0],[127,0,123,0],[128,0,124,0],[129,0,125,0],[130,0,126,0],[131,0,127,0],[132,0,128,0],[133,0,129,0],[134,0,130,0],[135,0,131,0],[136,0,132,0],[137,0,133,0],[138,0,134,0],[139,0,135,0],[140,0,136,0],[141,0,137,0],[142,2,138,7],[142,11,138,16,"wrap"],[142,15,138,20,"wrap"],[142,16,138,21,"middleware"],[142,26,138,31],[142,28,138,33,"callback"],[142,36,138,41],[142,38,138,43],[143,4,139,2],[144,4,140,2],[144,8,140,6,"called"],[144,14,140,12],[145,4,142,2],[145,11,142,9,"wrapped"],[145,18,142,16],[147,4,144,2],[148,0,145,0],[149,0,146,0],[150,0,147,0],[151,0,148,0],[152,0,149,0],[153,4,150,2],[153,13,150,11,"wrapped"],[153,20,150,18,"wrapped"],[153,21,150,19],[153,24,150,22,"parameters"],[153,34,150,32],[153,36,150,34],[154,6,151,4],[154,12,151,10,"fnExpectsCallback"],[154,29,151,27],[154,32,151,30,"middleware"],[154,42,151,40],[154,43,151,41,"length"],[154,49,151,47],[154,52,151,50,"parameters"],[154,62,151,60],[154,63,151,61,"length"],[154,69,151,67],[155,6,152,4],[156,6,153,4],[156,10,153,8,"result"],[156,16,153,14],[157,6,155,4],[157,10,155,8,"fnExpectsCallback"],[157,27,155,25],[157,29,155,27],[158,8,156,6,"parameters"],[158,18,156,16],[158,19,156,17,"push"],[158,23,156,21],[158,24,156,22,"done"],[158,28,156,26],[158,29,156,27],[159,6,157,4],[160,6,159,4],[160,10,159,8],[161,8,160,6,"result"],[161,14,160,12],[161,17,160,15,"middleware"],[161,27,160,25],[161,28,160,26,"apply"],[161,33,160,31],[161,34,160,32],[161,38,160,36],[161,40,160,38,"parameters"],[161,50,160,48],[161,51,160,49],[162,6,161,4],[162,7,161,5],[162,8,161,6],[162,15,161,13,"error"],[162,20,161,18],[162,22,161,20],[163,8,162,6],[163,14,162,12,"exception"],[163,23,162,21],[163,26,162,24],[163,46,162,46,"error"],[163,51,162,52],[165,8,164,6],[166,8,165,6],[167,8,166,6],[168,8,167,6],[169,8,168,6],[169,12,168,10,"fnExpectsCallback"],[169,29,168,27],[169,33,168,31,"called"],[169,39,168,37],[169,41,168,39],[170,10,169,8],[170,16,169,14,"exception"],[170,25,169,23],[171,8,170,6],[172,8,172,6],[172,15,172,13,"done"],[172,19,172,17],[172,20,172,18,"exception"],[172,29,172,27],[172,30,172,28],[173,6,173,4],[174,6,175,4],[174,10,175,8],[174,11,175,9,"fnExpectsCallback"],[174,28,175,26],[174,30,175,28],[175,8,176,6],[175,12,176,10,"result"],[175,18,176,16],[175,22,176,20,"result"],[175,28,176,26],[175,29,176,27,"then"],[175,33,176,31],[175,37,176,35],[175,44,176,42,"result"],[175,50,176,48],[175,51,176,49,"then"],[175,55,176,53],[175,60,176,58],[175,70,176,68],[175,72,176,70],[176,10,177,8,"result"],[176,16,177,14],[176,17,177,15,"then"],[176,21,177,19],[176,22,177,20,"then"],[176,26,177,24],[176,28,177,26,"done"],[176,32,177,30],[176,33,177,31],[177,8,178,6],[177,9,178,7],[177,15,178,13],[177,19,178,17,"result"],[177,25,178,23],[177,37,178,35,"Error"],[177,42,178,40],[177,44,178,42],[178,10,179,8,"done"],[178,14,179,12],[178,15,179,13,"result"],[178,21,179,19],[178,22,179,20],[179,8,180,6],[179,9,180,7],[179,15,180,13],[180,10,181,8,"then"],[180,14,181,12],[180,15,181,13,"result"],[180,21,181,19],[180,22,181,20],[181,8,182,6],[182,6,183,4],[183,4,184,2],[185,4,186,2],[186,0,187,0],[187,0,188,0],[188,0,189,0],[189,0,190,0],[190,4,191,2],[190,13,191,11,"done"],[190,17,191,15,"done"],[190,18,191,16,"error"],[190,23,191,21],[190,25,191,23],[190,28,191,26,"output"],[190,34,191,32],[190,36,191,34],[191,6,192,4],[191,10,192,8],[191,11,192,9,"called"],[191,17,192,15],[191,19,192,17],[192,8,193,6,"called"],[192,14,193,12],[192,17,193,15],[192,21,193,19],[193,8,194,6,"callback"],[193,16,194,14],[193,17,194,15,"error"],[193,22,194,20],[193,24,194,22],[193,27,194,25,"output"],[193,33,194,31],[193,34,194,32],[194,6,195,4],[195,4,196,2],[197,4,198,2],[198,0,199,0],[199,0,200,0],[200,0,201,0],[201,0,202,0],[202,4,203,2],[202,13,203,11,"then"],[202,17,203,15,"then"],[202,18,203,16,"value"],[202,23,203,21],[202,25,203,23],[203,6,204,4,"done"],[203,10,204,8],[203,11,204,9],[203,15,204,13],[203,17,204,15,"value"],[203,22,204,20],[203,23,204,21],[204,4,205,2],[205,2,206,0],[206,0,206,1],[206,3]],"functionMap":{"names":["<global>","trough","run","next","use","wrap","wrapped","done","then"],"mappings":"AAA;OCsC;ECS;ICiB;KDyB;GDC;EGG;GHS;CDC;OKkC;ECY;GDkC;EEO;GFK;EGO;GHE;CLC"},"hasCjsExports":false},"type":"js/module"}]}